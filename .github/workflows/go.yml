name: Go

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.16
        
    - uses: GoogleCloudPlatform/github-actions/setup-gcloud@master
      with:
        service_account_email: ${{ secrets.GCP_EMAIL }}
        service_account_key: ${{ secrets.GCP_SA_KEY }}
        export_default_credentials: true
    
    # Configure Docker with Credentials
    - name: Configure Docker
      run: |
        gcloud auth configure-docker
        
    - name: Use gcloud CLI
      run: gcloud info
  
    - name: Deploy auth-service
      run: cd auth-service && sh deploy.sh

    - name: Deploy follow-service
      run: cd follow-service && sh deploy.sh
    
    - name: Deploy image-service
      run: cd image-service && sh deploy.sh
    
    - name: Deploy post-service
      run: cd post-service && sh deploy.sh
    
    - name: Deploy user-service
      run: cd user-service && sh deploy.sh






